
<button id="connect"> Connect </button>

<button id="play"> Find my Seeebox </button>
<!-- <button id="mute"> Mute </button>
<button id="volup"> Volume Up </button>
<button id="voldown"> Volume Down </button>
<button id="change"> Change Track </button> -->


<script>

var enc = new TextEncoder(); // always utf-8
var charact;

document.getElementById("connect").addEventListener('pointerup', function(event) {
// bluetooth.requestDevice({ filters: [{ services: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e'] }] })
bluetooth.requestDevice({acceptAllDevices: true})
.then(device => {
    console.log('Connecting to GATT Server...');
    bluetoothDevice = device;
    return bluetoothDevice.gatt.connect();
})
.then(server => {
    console.log('Getting Device Services...');
    return server.getPrimaryServices();
})

.then(services => {
  let queue = Promise.resolve();
    services.forEach(service => {
      queue = queue.then(_ => service.getCharacteristics().then(characteristics => {
        console.log('> Service: ' + service.uuid);
        charact = characteristics;
        // charact.forEach(characteristic => {
        //   console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
        //       getSupportedProperties(characteristic));
        //   var valuu = enc.encode('P');
        //   return characteristic.writeValue(valuu);
        // });
      }));
    });
    return queue;
})
// .then(characteristic => {
//   // Reading Battery Level...
//   console.log(characteristic.uuid);
//   return characteristic.writeValue('P');
// })

.catch(error => { console.log(error); });
})


document.getElementById("play").addEventListener('pointerup', function(event) {
charact.forEach(characteristic => {
    charact.forEach(characteristic => {
          console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
              getSupportedProperties(characteristic));
          var valuu = enc.encode('P');
          return characteristic.writeValue(valuu);
        });
      });
    })


document.getElementById("mute").addEventListener('pointerup', function(event) {
charact.forEach(characteristic => {
    charact.forEach(characteristic => {
          console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
              getSupportedProperties(characteristic));
          var valuu = enc.encode('M');
          return characteristic.writeValue(valuu);
        });
      });
    })



document.getElementById("volup").addEventListener('pointerup', function(event) {
charact.forEach(characteristic => {
    charact.forEach(characteristic => {
          console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
              getSupportedProperties(characteristic));
          var valuu = enc.encode('U');
          return characteristic.writeValue(valuu);
        });
      });
    })



document.getElementById("voldown").addEventListener('pointerup', function(event) {
charact.forEach(characteristic => {
    charact.forEach(characteristic => {
          console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
              getSupportedProperties(characteristic));
          var valuu = enc.encode('D');
          return characteristic.writeValue(valuu);
        });
      });
    })

document.getElementById("change").addEventListener('pointerup', function(event) {
charact.forEach(characteristic => {
    charact.forEach(characteristic => {
          console.log('>> Characteristic: ' + characteristic.uuid + ' ' +
              getSupportedProperties(characteristic));
          var valuu = enc.encode('C');
          return characteristic.writeValue(valuu);
        });
      });
    })


function getSupportedProperties(characteristic) {
  let supportedProperties = [];
  for (const p in characteristic.properties) {
    if (characteristic.properties[p] === true) {
      supportedProperties.push(p.toUpperCase());
    }
  }
  return '[' + supportedProperties.join(', ') + ']';
}
</script>
